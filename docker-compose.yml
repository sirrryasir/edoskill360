version: '3.8' # Docker Compose version

services:
  # Service 1: Database (MongoDB)
  mongodb:
    image: mongo:latest
    container_name: edoskill360_db
    ports:
      - "27017:27017" # Database port
    volumes:
      - mongo_data:/data/db # Persistent storage for data
    networks:
      - app_network

  # Service 2: Backend (Server)
  server:
    build: ./server # Build server image using server/Dockerfile
    container_name: edoskill360_server
    env_file:
      - ./server/.env
    ports:
      - "5000:5000"
    environment:
      - PORT=5000
      # 'mongodb' is the service name used for internal networking
      - MONGO_URI=mongodb://mongodb:27017/edoskill360
      - JWT_SECRET=secret
    depends_on:
      - mongodb # Wait for database to be ready
    networks:
      - app_network

  # Service 3: Frontend (Client)
  client:
    build: ./client
    container_name: edoskill360_client
    ports:
      - "3000:3000"
    environment:
      # Browser communication with backend
      - NEXT_PUBLIC_API_URL=http://localhost:5000
      # Internal communication (Next.js server to Backend)
      - INTERNAL_API_URL=http://server:5000
    depends_on:
      - server
    networks:
      - app_network

# Network for service communication
networks:
  app_network:
    driver: bridge

# Storage for database data
volumes:
  mongo_data:
